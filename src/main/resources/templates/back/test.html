
<!DOCTYPE html>
<html xmlns:sec="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.6.6/video-js.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.6.6/video.min.js"></script>
    <script src="https://player.live-video.net/1.10.0/amazon-ivs-videojs-tech.min.js"></script>
    <script src="https://player.live-video.net/1.10.0/amazon-ivs-quality-plugin.min.js"></script>
</head>

<body>
    <div class="video-container">
        <form class="src-container-direct">
            <input class="src-input" placeholder="Enter .m3u8" />
            <button class="src-submit" type="submit">Load</button>
        </form>
        <video id="amazon-ivs-videojs" class="video-js vjs-4-3 vjs-big-play-centered" controls autoplay playsinline>
        </video>
    </div>
    <style>
        body {
            margin: 0;
        }

        .video-container {
            width: 640px;
            height: 480px;
            margin: 15px;
        }
    </style>
    <script>
    const DEFAULT_STREAM = "https://cff34ca342b3.ap-northeast-2.playback.live-video.net/api/video/v1/ap-northeast-2.328322480690.channel.hhsMUbOq5NC6.m3u8";
    (function () {
        registerIVSTech(videojs); 
        registerIVSQualityPlugin(videojs);

        const videoJSPlayer = videojs("amazon-ivs-videojs", {
            techOrder: ["AmazonIVS"],
            controlBar: {
                playToggle: {
                    replay: false
                }, 
                pictureInPictureToggle: false 
            }
        });

        const readyCallback = function () {
            window.videoJSPlayer = videoJSPlayer;

            const ivsPlayer = videoJSPlayer.getIVSPlayer();

            const videoContainerEl = document.querySelector("#amazon-ivs-videojs");
            videoContainerEl.addEventListener("click", () => {
                if (videoJSPlayer.paused()) {
                    videoContainerEl.classList.remove("vjs-has-started");
                } else {
                    videoContainerEl.classList.add("vjs-has-started");
                }
            });

            const PlayerState = videoJSPlayer.getIVSEvents().PlayerState;
            ivsPlayer.addEventListener(PlayerState.PLAYING, () => {
                console.log("Player State - PLAYING");
                setTimeout(() => {
                    console.log(
                        `This stream is ${
                            ivsPlayer.isLiveLowLatency() ? "" : "not "
                        }playing in ultra low latency mode`
                    );
                    console.log(`Stream Latency: ${ivsPlayer.getLiveLatency()}s`);
                }, 3000);
            });

            // Log errors
            const PlayerEventType = videoJSPlayer.getIVSEvents().PlayerEventType;
            ivsPlayer.addEventListener(PlayerEventType.ERROR, (type, source) => {
                console.warn("Player Event - ERROR: ", type, source);
            });

            ivsPlayer.addEventListener(PlayerEventType.TEXT_METADATA_CUE, (cue) => {
                const metadataText = cue.text;
                const position = ivsPlayer.getPosition().toFixed(2);
                console.log(
                    `Player Event - TEXT_METADATA_CUE: "${metadataText}". Observed ${position}s after playback started.`
                );
            });

            videoJSPlayer.enableIVSQualityPlugin();

            videoJSPlayer.volume(0.5);
            videoJSPlayer.src(DEFAULT_STREAM);
        };

        videoJSPlayer.ready(readyCallback);
    })();

    /* 
    (function () {
        const containerEl = document.querySelector(".video-container");
        const directSrcFormEl = containerEl.querySelector(".src-container-direct");
        const directSrcInputEl = containerEl.querySelector(".src-input");
        directSrcFormEl.addEventListener("submit", (e) => {
            e.preventDefault();
            videoJSPlayer.src(directSrcInputEl.value);
        });
    })(); */

    </script>
</body>

</html>