<!DOCTYPE html>
<html>
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
   href="/resources/_ui/desktop/common/css/mobile.css">
   
<link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.14.3/video-js.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.14.3/video.min.js"></script>
    <script src="https://player.live-video.net/1.10.0/amazon-ivs-videojs-tech.min.js"></script>

<!-- Bootstrap CSS -->
<link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
   rel="stylesheet"
   integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
   crossorigin="anonymous">
</head>
<body>
   <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
      
   <script>
        (function play() {
            // Get playback URL from Amazon IVS API
            var PLAYBACK_URL = '';
            
            // Register Amazon IVS as playback technology for Video.js
            registerIVSTech(videojs);

            // Initialize player
            var player = videojs('amazon-ivs-videojs', {
               techOrder: ["AmazonIVS"]
            }, () => {
               console.log('Player is ready to use!');
               // Play stream
               player.src(PLAYBACK_URL);
            });
        })();
    </script>
   
   <script>
        const username = "[[${member.getMemail()}]]";
        const websocket = new WebSocket("ws://localhost:8080/ws/chat");

        websocket.onmessage = onMessage;
        websocket.onopen = onOpen;
        websocket.onclose = onClose;

        function send() {
            if ($("#msg").val() == "") return;
            console.log("SEND");
            let msg = document.getElementById("msg");

            console.log(username + ":" + msg.value);
            websocket.send(username + ":" + msg.value);
            msg.value = "";
        }

        //채팅창에 들어왔을 때
        function onOpen(evt) {
            var str = username + ": 님이 입장하셨습니다.";
            websocket.send(str);
        }

        //채팅창에서 나갔을 때
        function onClose(evt) {
            var str = username + ": 님이 방을 나가셨습니다.";
            websocket.send(str);
        }

        function onMessage(msg) {
            //console.log(msg);
            var data = msg.data;
            var sessionId = null;
            //데이터를 보낸 사람
            var message = null;
            var arr = data.split(":");

            for (var i = 0; i < arr.length; i++) {
                console.log("arr[" + i + "]: " + arr[i]);
            }

            var cur_session = username;

            //현재 세션에 로그인 한 사람
            console.log("cur_session : " + cur_session);

            sessionId = arr[0];
            message = arr[1];

            console.log("sessionID : " + sessionId);
            console.log("cur_session : " + cur_session);

            if (arr[1] == " 님이 입장하셨습니다." || arr[1] == " 님이 방을 나가셨습니다.") {
                var str = "<div class='col-6'>";
                str += "<li class='alert alert-secondary'>";
                str += "<b style='color: #3f729b'>" + sessionId + message + "</b>";
                str += "</li</div>";
                $("#msgArea").append(str);
            } else {
                //로그인 한 클라이언트와 타 클라이언트를 분류하기 위함
                if (sessionId == cur_session) {
                    var str = "<div class='col-6'>";
                    str += "<li class='alert alert-secondary'>";
                    str += "<span><span style='color: #574a95;'>" + sessionId + "</span> : " + message + "</span>";
                    str += "</li></div>";
                    $("#msgArea").append(str);
                } else {
                    var str = "<div class='col-6'>";
                    str += "<li class='alert alert-warning'>";
                    str += "<span><span style='color: #574a95;'>" + sessionId + "</span> : " + message + "</span>";
                    str += "</li></div>";
                    $("#msgArea").append(str);
                }
            }
        }
    </script>
    <div class="head">
        <div class="logo"></div>
        <h3 class="cnts_title ou1804" style="text-align: center;">
            <span class="title">
                H-DAY STREAMING
            </span>
        </h3>
    </div>
   <div id="main">
      <!-- 스트리밍 -->
      <div id="streaming">
           <video id="amazon-ivs-videojs" class="video-js vjs-4-3 vjs-big-play-centered" controls autoplay playsinline></video>
       </div>

      <!-- 채팅방 -->
      <div id="chating">
         <div class="col-6">
            <label><b>채팅방</b></label>
         </div>
         <div>
            <div id="msgArea" class="col"></div>
            <div class="col-6">
               <div class="input-group mb-3">
                  <input style="width: 80%; background-color: white" type="text"
                     id="msg" class="form-control" aria-label="Recipient's username"
                     aria-describedby="button-addon2"
                     onkeyup="if(window.event.keyCode==13){send()}" />
                  <button class="btn btn-outline-secondary" type="button"
                     id="button-send" onclick="send()">전송</button>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="txt">
        <p class="tit">aweSOME life 7.<br>HANESOME-E</p>
        <p class="s_t">변함없는 지구를 그리며<br>GKMCC와 함께한 지속 가능한 선택</p>
    </div>
    <div class="watchagain">
        <div class="again again1">다시보기1</div>
        <div class="again again2">다시보기2</div>
        <div class="again again3">다시보기3</div>
        <div class="again again4">다시보기4</div>
        <div class="again again5">다시보기5</div>
        <div class="again again6">다시보기6</div>
        <div class="again again7">다시보기7</div>
        <div class="again again8">다시보기8</div>
    </div>
    
    <style>
        body {
            margin: 0;
        }

        .video-container {
            width: 640px;
            height: 480px;
            margin: 15px;
        }
    </style>
</body>
</html>